{% extends "base.html" %}

{% block content %}
<h2>ğŸŒ¦ ê¸°ìƒ ë¡œê·¸ ë·°ì–´</h2>

<!-- ë‚ ì§œ ì„ íƒ + ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
<div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
  <label>ë‚ ì§œ ì„ íƒ:</label>
  <input type="date" id="log-date" value="{{ today }}">
  <a id="download-link" href="/weatherdata/download/?date={{ today }}" style="
    background-color: #0288d1;
    color: white;
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 14px;
    text-decoration: none;
">ğŸ“¥ CSV ë‹¤ìš´ë¡œë“œ</a>
</div>

<!-- ì˜ˆìœ ì¹´ë“œí˜• í…Œì´ë¸” íŒ¨ë„ -->
<div style="display: flex; overflow-x: auto; gap: 20px; padding-bottom: 10px;">
  <div style="
      background-color: #f1f8e9;
      padding: 20px;
      border-radius: 12px;
      width: 600px;
      min-width: 600px;
      height: auto;
      overflow: auto;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      flex: 0 0 auto;
  ">
    <h3 style="margin-top: 0;">ğŸ“Š {{ today }} ê¸°ìƒ ë°ì´í„°</h3>
    <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
      <thead>
        <tr style="background-color: #dcedc8;">
          <th style="padding: 8px; border: 1px solid #aaa;">Time</th>
          <th style="padding: 8px; border: 1px solid #aaa;">CO2</th>
          <th style="padding: 8px; border: 1px solid #aaa;">Temp</th>
          <th style="padding: 8px; border: 1px solid #aaa;">Humi</th>
          <th style="padding: 8px; border: 1px solid #aaa;">Lux</th>
        </tr>
      </thead>
      <tbody>
        {% for row in weather_data %}
        <tr>
          <td style="padding: 6px; border: 1px solid #ccc;">{{ row.Time }}</td>
          <td style="padding: 6px; border: 1px solid #ccc;">{{ row.CO2 }}</td>
          <td style="padding: 6px; border: 1px solid #ccc;">{{ row.Temp }}</td>
          <td style="padding: 6px; border: 1px solid #ccc;">{{ row.Humi }}</td>
          <td style="padding: 6px; border: 1px solid #ccc;">{{ row.Lux }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="5" style="text-align:center;">ğŸ“­ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
  // ë‚ ì§œ ì„ íƒ ì‹œ í˜ì´ì§€ ì´ë™
  document.getElementById("log-date").addEventListener("change", function() {
    const selectedDate = this.value;
    // í˜ì´ì§€ ì´ë™
    window.location.href = `/weatherdata/?date=${selectedDate}`;
});


  // ë‹¤ìš´ë¡œë“œ ë§í¬ ë™ê¸°í™”
  document.addEventListener("DOMContentLoaded", function() {
    const date = document.getElementById("log-date").value;
    document.getElementById("download-link").href = `/weatherdata/download/?date=${date}`;
});
</script>
{% endblock %}
